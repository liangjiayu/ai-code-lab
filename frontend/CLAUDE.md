# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Commands

```bash
pnpm dev          # Start dev server (http://localhost:5173)
pnpm build        # Production build
pnpm start        # Serve production build
pnpm typecheck    # Generate React Router types + run tsc
pnpm openapi2ts   # Re-generate API services from backend OpenAPI spec
```

## Architecture

This is a React SPA (SSR disabled via `react-router.config.ts`) built with React Router v7, styled after a Gemini-like chat interface.

**Tech stack:** React 19, React Router v7 (file-based routing), Vite 7, Tailwind CSS v4, Zustand, TanStack React Query, Axios, @headlessui/react, Remixicon icons, TypeScript, pnpm

**Path alias:** `~/` maps to `app/`

### Key directories

- `app/routes/` — File-based route components (configured in `app/routes.ts`)
- `app/components/layout/` — Layout components (Sidebar, MainHeader, ChatInput, etc.)
- `app/components/ui/` — Reusable UI primitives
- `app/stores/` — Zustand stores (chat-store.ts manages sidebar, conversations, input state)
- `app/services/api/` — **Auto-generated** API service layer from OpenAPI spec (do not edit manually)
- `app/queries/` — TanStack React Query hooks
- `app/types/` — TypeScript type definitions (Conversation, Message, ConversationGroup)
- `app/lib/` — Utilities (`cn()`, `request` axios wrapper, mock data)

### API layer

- `app/lib/request.ts` — Axios wrapper that extracts `res.data` and throws on `code !== 200`
- `app/services/api/` — Generated by `@umijs/openapi` from backend at `http://127.0.0.1:8100/openapi.json`
- Config in `openapi2ts.config.ts` — sets `requestImportStatement` to use the custom request wrapper
- **Do not manually edit** files in `app/services/api/`; run `pnpm openapi2ts` to regenerate

### Routing

Routes defined in `app/routes.ts`:
- `app-layout.tsx` — Shared layout (Sidebar + MainHeader + ChatInput + `<Outlet />`)
- `/` → `home.tsx` — Welcome page
- `/:id` → `chat.tsx` — Chat conversation detail

### State management

- **Zustand** for client-side UI state (sidebar toggle, active conversation, input value)
- **React Query** for server state — QueryClient configured with 60s staleTime, 1 retry

### Styling

Tailwind CSS v4 with custom theme variables defined in `app/app.css` (`--color-sidebar-bg`, `--color-accent`, etc.). Light theme with Gemini-inspired design tokens.

### Component hierarchy

```
root.tsx (QueryClientProvider)
  └─ app-layout.tsx (Sidebar + MainHeader + ChatInput)
      ├─ / → home.tsx → WelcomeArea
      └─ /:id → chat.tsx → ChatMessageList
```
